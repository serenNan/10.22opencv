# 流水线产品质量检测系统 (Conveyor Belt Product Quality Inspection System)

基于OpenCV的PCB电路板质量检测系统，用于自动识别和统计流水线上的合格品和次品。

## 项目概述

本系统实现了两个计算机视觉任务：
1. **任务1：流水线产品识别** - 检测视频中从右向左移动的PCB板，分类为合格品（矩形）或次品（三角形）
2. **任务2：公式识别** - 待实现

## 功能特点

- 实时检测和分类PCB产品（合格品/次品）
- 自动跟踪产品避免重复计数
- 检测产品的旋转角度和缩放比例
- 实时输出检测结果
- 最终统计报告

## 检测结果

### 视频1 (video/1.mp4)
- 合格品：3个
- 次品：3个
- 总计：6个

### 视频2 (video/2.mp4)
- 合格品：4个
- 次品：2个
- 总计：6个

## 使用方法

### 编译

```bash
mkdir build
cd build
cmake ..
make
```

### 运行

```bash
# 从build目录运行（基本模式）
./conveyor_inspection_cli

# 保存调试帧（会在output_1/和output_2/目录保存带检测标注的图像）
./conveyor_inspection_cli --save-frames
```

### 依赖

- OpenCV 4.x
- C++11或更高版本
- CMake 3.10或更高版本

### 说明

- 命令行版本，无需GUI支持，适合在WSL或服务器环境运行
- 实时输出中文检测信息到控制台
- 使用 `--save-frames` 参数会保存带检测标注的图像帧用于调试

## 技术实现

### 检测算法

1. **颜色检测**
   - 使用HSV颜色空间检测绿色PCB板
   - 颜色范围：H(35-85), S(40-255), V(40-255)

2. **形状分类**
   - 矩形PCB → 合格品
   - 三角形PCB → 次品
   - 使用轮廓近似和凸包分析

3. **产品跟踪**
   - 基于质心的距离跟踪
   - 防止重复计数
   - 设置计数线（左侧20%位置）

4. **旋转和缩放检测**
   - 使用minAreaRect获取旋转矩形
   - 计算角度和缩放因子
   - 参考尺寸：200像素

### 关键参数

- **颜色范围**：绿色HSV值 (35-85, 40-255, 40-255)
- **最小面积**：1000像素
- **跟踪距离阈值**：80像素
- **计数线位置**：画面宽度的20%
- **匹配距离阈值**：50像素

## 项目结构

```
.
├── conveyor_inspection_cli.cpp     # C++ CLI实现（主程序）
├── CMakeLists.txt                  # CMake构建配置
├── video/                          # 视频文件目录
│   ├── 1.mp4
│   └── 2.mp4
├── 要求/                           # 项目需求文档
│   ├── 1.jpg
│   └── 2.jpg
├── build/                          # 编译输出目录（由cmake生成）
│   ├── conveyor_inspection_cli     # CLI可执行文件
│   ├── output_1/                   # 视频1调试帧输出（--save-frames时生成）
│   └── output_2/                   # 视频2调试帧输出（--save-frames时生成）
├── README.md                       # 本文件
├── CLAUDE.md                       # Claude Code项目说明
└── .gitignore                      # Git忽略规则
```

## 扩展功能

已实现的扩展需求：
- ✅ 处理旋转和缩放变化
- ✅ 输出旋转角度和缩放倍数
- ✅ 实时输出检测结果
- ✅ 快速识别（30fps处理速度）
- ✅ 支持多种分辨率

## 性能

- 视频1 (852x344): 处理311帧，约10.4秒
- 视频2 (1216x720): 处理421帧，约14.0秒
- 实时处理速度：30fps

## 输出示例

```
============================================================
Processing: video/1.mp4
============================================================

Frame 82: DEFECTIVE detected - Angle: 90.0°, Scale: 1.09x | Qualified: 0, Defective: 1
Frame 99: QUALIFIED detected - Angle: 90.0°, Scale: 1.34x | Qualified: 1, Defective: 1
Frame 173: QUALIFIED detected - Angle: 90.0°, Scale: 1.29x | Qualified: 2, Defective: 1
...

============================================================
FINAL STATISTICAL REPORT
============================================================
Video: video/1.mp4
------------------------------------------------------------
Qualified Products: 3
Defective Products: 3
Total Products:     6
============================================================
```

## 许可证

本项目仅用于教学和学习目的。
